<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Research Paper Creator</title>
    <style>
        :root{
            --bg: #f5f7fa;
            --panel: #ffffff;
            --muted: #6b7280;
            --primary-start: #667eea;
            --primary-end: #764ba2;
            --primary: #667eea;
            --accent: #764ba2;
            --shadow: 0 6px 18px rgba(16,24,40,0.08);
        }
        * { box-sizing: border-box; }
        body { margin:0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:var(--bg); color:#1f2937; }
        .container { max-width:1100px; margin:28px auto; padding:28px; }


        .page-header{ background: linear-gradient(135deg,var(--primary-start) 0%,var(--primary-end) 100%); color:white; padding:18px 22px; border-radius:10px; box-shadow:var(--shadow); display:flex; align-items:center; gap:16px; }
        .page-header h1{ margin:0; font-size:20px; font-weight:600; }


        .toolbar { background:var(--panel); padding:8px; border-radius:8px; box-shadow:0 2px 8px rgba(15,23,42,0.06); display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-top:14px; }
        .ribbon-group{ background:linear-gradient(180deg,rgba(15,23,42,0.02),transparent); border-radius:6px; padding:8px; display:flex; gap:8px; align-items:center; border:1px solid rgba(15,23,42,0.03); }
        .ribbon-title{ font-size:11px; color:var(--muted); padding:0 6px; }
        .toolbar button, .toolbar select, .toolbar input[type="color"] { background:transparent; border:1px solid rgba(15,23,42,0.04); padding:8px 10px; border-radius:6px; cursor:pointer; color:var(--muted); font-weight:600; }
        .toolbar button:hover, .toolbar select:hover { background:rgba(102,126,234,0.06); color:var(--primary); }
        .toolbar button.primary { background:linear-gradient(90deg,var(--primary-start),var(--primary-end)); color:white; border:none; }
        .toolbar .spacer{ flex:1 }
        .icon-btn{ width:40px; height:36px; display:inline-flex; align-items:center; justify-content:center; font-weight:700; border-radius:6px; }
        .label-btn{ padding:8px 12px; }
        .sep{ width:1px; height:36px; background:linear-gradient(180deg,rgba(15,23,42,0.04),rgba(15,23,42,0.02)); margin:0 8px; border-radius:1px }
        .ribbon-select{ min-width:140px; }
        .ribbon-size{ width:64px }


        #editorWrap { margin-top:14px; background:transparent; padding:0; border-radius:6px; }
        #editor { background:var(--panel); min-height:640px; padding:36px; border-radius:8px; box-shadow:0 4px 24px rgba(16,24,40,0.06); outline:none; border:1px solid rgba(15,23,42,0.04); }
        #editor:focus { box-shadow:0 8px 28px rgba(102,126,234,0.12); }
        #editor h2{ margin-top:0; color:#0f172a; }


        #stats{ color:var(--muted); font-size:13px }


        /* find/replace modal */
        #findReplace{ border-radius:8px; }


        table { border-collapse:collapse; }
        table td, table th { border:1px solid rgba(15,23,42,0.06); padding:8px }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-header">
            <h1>Research Paper Creator</h1>
        </div>


        <div class="toolbar" role="toolbar" aria-label="Text formatting toolbar">
            <div class="ribbon-group">
                <div>
                    <div class="ribbon-title">Font</div>
                    <div style="display:flex;gap:8px;align-items:center;margin-top:6px">
                        <select id="fontFamily" class="ribbon-select" onchange="setFontName(this.value)" onmousedown="saveSelection(); event.preventDefault();">
                            <option value="Segoe UI">Segoe UI</option>
                            <option value="Arial">Arial</option>
                            <option value="Times New Roman">Times New Roman</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Courier New">Courier New</option>
                            <option value="Bookman Old Style">Bookman Old Style</option>
                        </select>
                        <select id="fontSize" class="ribbon-size" onchange="setFontSize(this.value)" onmousedown="saveSelection(); event.preventDefault();">
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12" selected>12</option>
                            <option value="14">14</option>
                            <option value="16">16</option>
                            <option value="18">18</option>
                            <option value="20">20</option>
                            <option value="24">24</option>
                        </select>
                        <button type="button" class="icon-btn" onclick="exec('bold')" title="Bold" onmousedown="saveSelection(); event.preventDefault();"><b>B</b></button>
                        <button type="button" class="icon-btn" onclick="exec('italic')" title="Italic" onmousedown="saveSelection(); event.preventDefault();"><i>I</i></button>
                        <button type="button" class="icon-btn" onclick="exec('underline')" title="Underline" onmousedown="saveSelection(); event.preventDefault();"><u>U</u></button>
                        <button type="button" class="icon-btn" onclick="exec('strikeThrough')" title="Strikethrough" onmousedown="saveSelection(); event.preventDefault();">S</button>
                        <input type="color" id="foreColor" title="Text color" onchange="exec('foreColor', this.value)" onmousedown="saveSelection()">
                        <input type="color" id="hiliteColor" title="Highlight color" onchange="exec('hiliteColor', this.value)" onmousedown="saveSelection()">
                    </div>
                </div>
            </div>


            <div class="ribbon-group">
                <div>
                    <div class="ribbon-title">Paragraph</div>
                    <div style="display:flex;gap:8px;align-items:center;margin-top:6px">
                        <button type="button" class="icon-btn" onclick="exec('insertUnorderedList')" title="Bulleted List" onmousedown="saveSelection(); event.preventDefault();">‚Ä¢</button>
                        <button type="button" class="icon-btn" onclick="exec('insertOrderedList')" title="Numbered List" onmousedown="saveSelection(); event.preventDefault();">1</button>
                        <div class="sep" aria-hidden="true"></div>
                        <button type="button" class="icon-btn" onclick="exec('justifyLeft')" title="Align left" onmousedown="saveSelection(); event.preventDefault();">‚üµ</button>
                        <button type="button" class="icon-btn" onclick="exec('justifyCenter')" title="Align center" onmousedown="saveSelection(); event.preventDefault();">‚ü∑</button>
                        <button type="button" class="icon-btn" onclick="exec('justifyRight')" title="Align right" onmousedown="saveSelection(); event.preventDefault();">‚ü∂</button>
                        <div class="sep" aria-hidden="true"></div>
                        <button type="button" class="icon-btn" onclick="exec('indent')" title="Indent" onmousedown="saveSelection(); event.preventDefault();">‚Üí</button>
                        <button type="button" class="icon-btn" onclick="exec('outdent')" title="Outdent" onmousedown="saveSelection(); event.preventDefault();">‚Üê</button>
                    </div>
                </div>
            </div>


            <div class="ribbon-group">
                <div>
                    <div class="ribbon-title">Insert</div>
                    <div style="display:flex;gap:8px;align-items:center;margin-top:6px">
                        <button type="button" class="icon-btn" onclick="triggerImage()" title="Insert image" onmousedown="saveSelection(); event.preventDefault();">üñº</button>
                        <input type="file" id="imgInput" accept="image/*" style="display:none" onchange="insertImage(event)">
                        <button type="button" class="label-btn" onclick="insertTable()" title="Insert table" onmousedown="saveSelection(); event.preventDefault();">Table</button>
                    </div>
                </div>
            </div>


            <div class="ribbon-group">
                <div>
                    <div class="ribbon-title">Editing</div>
                        <div style="display:flex;gap:8px;align-items:center;margin-top:6px">
                        <button type="button" class="label-btn" onclick="showFindReplace()" title="Find & Replace" onmousedown="saveSelection(); event.preventDefault();">Find</button>
                        <button type="button" class="icon-btn" onclick="undo()" title="Undo" onmousedown="saveSelection(); event.preventDefault();">‚Ü∫</button>
                        <button type="button" class="icon-btn" onclick="redo()" title="Redo" onmousedown="saveSelection(); event.preventDefault();">‚Üª</button>
                    </div>
                </div>
            </div>


            <div class="spacer"></div>


            <div style="display:flex;align-items:center;gap:10px">
                <span id="stats">Words: 0 ‚Ä¢ Chars: 0</span>
                <div class="sep" aria-hidden="true"></div>
                <button type="button" class="label-btn" onclick="newDoc()" title="New document" onmousedown="saveSelection(); event.preventDefault();">New</button>
                <button type="button" class="label-btn" onclick="openDoc()" title="Open HTML file" onmousedown="saveSelection(); event.preventDefault();">Open</button>
                <input type="file" id="openInput" accept="text/html,.html,.htm,.txt" style="display:none" onchange="openFile(event)">
                <button type="button" class="label-btn primary" onclick="downloadDoc()" title="Download as Word document" onmousedown="saveSelection(); event.preventDefault();">Save</button>
                <button type="button" class="label-btn" onclick="downloadHTML()" title="Download HTML" onmousedown="saveSelection(); event.preventDefault();">Export HTML</button>
                <button type="button" class="label-btn" onclick="printDoc()" title="Print document" onmousedown="saveSelection(); event.preventDefault();">Print</button>
            </div>
        </div>


        <div id="editorWrap">
            <div id="editor" contenteditable="true" spellcheck="true">
                <h2>Title</h2>
                <p>Start writing your research paper here...</p>
            </div>
        </div>
    </div>


    <div id="findReplace" style="display:none; position:fixed; right:20px; top:100px; width:300px; background:#fff; padding:12px; box-shadow:0 4px 16px rgba(0,0,0,0.15); border-radius:6px; z-index:9999">
        <div style="display:flex;gap:8px;margin-bottom:8px"><input id="findInput" placeholder="Find" style="flex:1;padding:6px"><button onclick="findNext()">Next</button></div>
        <div style="display:flex;gap:8px;margin-bottom:8px"><input id="replaceInput" placeholder="Replace" style="flex:1;padding:6px"><button onclick="replaceAll()">Replace All</button></div>
        <div style="text-align:right"><button onclick="hideFindReplace()">Close</button></div>
    </div>


    <script>
        function exec(command, value=null){
            restoreSelection();
            try{ document.execCommand(command, false, value); }catch(e){}
            document.getElementById('editor').focus();
            scheduleSave();
            updateStats();
        }


        function setFontName(name){
            restoreSelection();
            const sel = window.getSelection();
            if(sel.rangeCount && sel.getRangeAt(0).collapsed){
                applyStyleAtCaret('font-family:'+name+';');
            }else{
                exec('fontName', name);
            }
        }


        function setFontSize(size){
            // wrap selection with span style to set exact px size
            restoreSelection();
            const sel = window.getSelection();
            if(sel.rangeCount && sel.getRangeAt(0).collapsed){
                applyStyleAtCaret('font-size:'+parseInt(size,10)+'px');
            }else{
                wrapSelectionWithSpan('font-size:'+parseInt(size,10)+'px');
            }
            scheduleSave(); updateStats();
        }


        function wrapSelectionWithSpan(style){
            const sel = window.getSelection(); if(!sel.rangeCount) return;
            const range = sel.getRangeAt(0);
            if(range.collapsed) return;
            const fragment = range.extractContents();
            const span = document.createElement('span');
            span.setAttribute('style', style);
            span.appendChild(fragment);
            range.insertNode(span);
            // restore selection inside the newly inserted span
            sel.removeAllRanges();
            const newRange = document.createRange();
            newRange.selectNodeContents(span);
            sel.addRange(newRange);
        }


        function applyStyleAtCaret(style){
            const sel = window.getSelection(); if(!sel.rangeCount) return;
            const range = sel.getRangeAt(0);
            // create a span with zero-width space so typing continues inside it
            const span = document.createElement('span');
            span.setAttribute('style', style);
            const zw = document.createTextNode('\u200B');
            span.appendChild(zw);
            range.insertNode(span);
            // place caret after the zero-width char inside the span
            range.setStart(span.firstChild, 1);
            range.setEnd(span.firstChild, 1);
            sel.removeAllRanges();
            sel.addRange(range);
        }
        function undo(){ document.execCommand('undo'); }
        function redo(){ document.execCommand('redo'); }
        function triggerImage(){ document.getElementById('imgInput').click(); }
        function insertImage(e){
            const file = e.target.files[0]; if(!file) return;
            const reader = new FileReader();
            reader.onload = function(evt){
                restoreSelection();
                exec('insertImage', evt.target.result);
            };
            reader.readAsDataURL(file);
            e.target.value = '';
        }


        function newDoc(){
            if(!confirm('Create new document? Unsaved changes will be lost.')) return;
            document.getElementById('editor').innerHTML = '<h2>Title</h2><p></p>';
        }


        function openDoc(){ document.getElementById('openInput').click(); }
        function openFile(e){
            const f = e.target.files[0]; if(!f) return;
            const reader = new FileReader();
            reader.onload = function(evt){
                document.getElementById('editor').innerHTML = evt.target.result;
                updateStats();
            };
            reader.readAsText(f);
            e.target.value = '';
        }


        function downloadDoc(){
            const header = '<!doctype html><html><head><meta charset="utf-8"></head><body>';
            const footer = '</body></html>';
            const content = header + document.getElementById('editor').innerHTML + footer;
            const blob = new Blob([content], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'research-paper.doc';
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
        }


        function printDoc(){
            const w = window.open('', '_blank');
            w.document.write('<!doctype html><html><head><meta charset="utf-8"><title>Print</title></head><body>');
            w.document.write(document.getElementById('editor').innerHTML);
            w.document.write('</body></html>');
            w.document.close();
            w.focus();
            setTimeout(()=>{ w.print(); w.close(); }, 300);
        }


        function downloadHTML(){
            const content = '<!doctype html><html><head><meta charset="utf-8"></head><body>' + document.getElementById('editor').innerHTML + '</body></html>';
            const blob = new Blob([content], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'research-paper.html'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
        }


        // Autosave to localStorage
        const SAVE_KEY = 'research-paper-draft';
        let saveTimer = null;
        function scheduleSave(){
            if(saveTimer) clearTimeout(saveTimer);
            saveTimer = setTimeout(()=>{ saveDraft(); }, 2000);
        }
        function saveDraft(){
            const data = { html: document.getElementById('editor').innerHTML, ts: Date.now() };
            try{ localStorage.setItem(SAVE_KEY, JSON.stringify(data)); document.getElementById('stats').dataset.saved = data.ts; }catch(e){}
        }
        function restoreDraft(){
            try{
                const raw = localStorage.getItem(SAVE_KEY); if(!raw) return false;
                const data = JSON.parse(raw);
                if(data && data.html){ document.getElementById('editor').innerHTML = data.html; updateStats(); return true; }
            }catch(e){}
            return false;
        }


        function clearDraft(){ localStorage.removeItem(SAVE_KEY); }


        function updateStats(){
            const text = document.getElementById('editor').innerText || '';
            const words = text.trim().length ? text.trim().split(/\s+/).length : 0;
            const chars = text.replace(/\s/g,'').length;
            document.getElementById('stats').textContent = `Words: ${words} ‚Ä¢ Chars: ${chars}`;
        }


        // Find / Replace (basic)
        function showFindReplace(){ document.getElementById('findReplace').style.display = 'block'; document.getElementById('findInput').focus(); }
        function hideFindReplace(){ document.getElementById('findReplace').style.display = 'none'; }
        function findNext(){ const q = document.getElementById('findInput').value; if(!q) return; window.find(q, false, false, true); }
        function replaceAll(){ const q = document.getElementById('findInput').value; const r = document.getElementById('replaceInput').value; if(!q) return; if(!confirm('Replace all occurrences of "'+q+'" with "'+r+'"?')) return; const el = document.getElementById('editor'); el.innerHTML = el.innerHTML.split(q).join(r); updateStats(); scheduleSave(); }


        function insertTable(){ const rows = parseInt(prompt('Rows', '2')); const cols = parseInt(prompt('Cols', '2')); if(isNaN(rows) || isNaN(cols) || rows<1 || cols<1) return; let html = '<table border="1" style="border-collapse:collapse;width:100%">'; for(let r=0;r<rows;r++){ html += '<tr>'; for(let c=0;c<cols;c++){ html += '<td style="padding:6px">&nbsp;</td>'; } html += '</tr>'; } html += '</table><p></p>'; exec('insertHTML', html); }


        // Save / restore selection so toolbar clicks don't lose selection
        let _savedRange = null;
        function saveSelection(){ const sel = window.getSelection(); if(sel.rangeCount) try{ _savedRange = sel.getRangeAt(0).cloneRange(); }catch(e){ _savedRange = null; } }
        function restoreSelection(){ const editorEl = document.getElementById('editor'); try{ editorEl.focus(); }catch(e){}
            const sel = window.getSelection(); sel.removeAllRanges(); if(_savedRange){ try{ sel.addRange(_savedRange); }catch(e){ /* if original range invalid, place caret at end of editor */ const r = document.createRange(); r.selectNodeContents(editorEl); r.collapse(false); sel.addRange(r); } } else { const r = document.createRange(); r.selectNodeContents(editorEl); r.collapse(false); sel.addRange(r); } }


        // keep selection when interacting with toolbar
        document.querySelector('.toolbar').addEventListener('mousedown', function(e){
            const btn = e.target.closest('button');
            const selEl = e.target.closest('select');
            const color = e.target.closest('input[type="color"]');
            if(btn || selEl || color){ saveSelection(); }
        });


        // keyboard shortcuts: Ctrl+S to download
        document.addEventListener('keydown', function(e){
            if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's'){
                e.preventDefault(); downloadDoc();
            }
            if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'b'){
                // let browser handle Ctrl+B for bold
            }
        });


        // update stats on input and autosave
        const editor = document.getElementById('editor');
        ['input','keyup','paste','cut'].forEach(ev => editor.addEventListener(ev, ()=>{ updateStats(); scheduleSave(); }));


        // restore draft on load
        window.addEventListener('load', ()=>{
            updateStats();
            const raw = localStorage.getItem(SAVE_KEY);
            if(raw){ if(confirm('A saved draft was found. Restore it?')){ restoreDraft(); } }
        });


        // keyboard shortcuts: Ctrl+S to download
        document.addEventListener('keydown', function(e){
            if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's'){
                e.preventDefault(); downloadDoc();
            }
        });
    </script>
</body>
</html>




